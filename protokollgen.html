<!DOCTYPE html>
<html>
<head>


	<meta charset="UTF-8">
	<style>
		#resetButton {
			display: block;
			position: absolute;
			right: 0;
			top: 0;
		}
	
		.errorMessage {
			color:red;
		}
	
	
		html {
			max-width: 2000px;
			margin-left: auto;
			margin-right: auto;
		}
		#input {
			float: left;
			width: 48%;
		}
		
		#output {
			float: left;
			width: 48%;
		}
		body {
			font-family: "Open Sans",Arial,Helvetica,sans-serif;
			padding: 30px;
			font-size: 12px;
			padding-left: 90px;
		}
		code {
			background-color: #ddd;
			font-weight: initial;
		}
		.shortDescription {
			font-size: 16px;
		}
		.object {
			font-weight: bold;
			font-style: italic
		}
		table {
			border-collapse: collapse;
		}
		td, th {
			border: 1px solid #ccc;
			padding: 6px;
		}
		th {
			background-color: #ddd;
		}
		h1 {
			font-size: 40px;
			margin-bottom: 4px;
		}
		h2 {
			padding-top: 30px;
			margin-top: 50px;
			font-size: 36px;
			margin-bottom: 4px;
		}
		h3 {
			border-top: 2px dotted grey;
			padding-top: 30px;
			font-size: 30px;
			margin-bottom: 4px;
			margin-left: -40px;
		}
		h4 {
			font-size: 24px;
			margin-bottom: 4px;
			margin-left: -30px;
		}
		h5 {
			font-size: 18px;
			margin-bottom: 4px;
			margin-left: -20px;
		}
		
		code.pre {
			padding: 10px;
			display: inline-block;
			white-space: pre;
			visibility: hidden;
		}
		
		p {
			margin-top: 12px;
			margin-bottom: 4px;
		}
		
		.required {
			color: red;
		}
	</style>
		
	<title>Protokollgenerator</title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>

	<script>
		function validateVb(text) {
			//if(text.indexOf("ingenting") >= 0) {
			if(text == "ingenting") {
				return "Ni måste göra något";
			}
			
			if(text.length <= 30) {
				return "Verksamhetsberättelsen är för kort";
			}
			return null;
		}
		
		function validate(event) {
			var target = $(event.currentTarget).parents(".meetingPointContainer").first();
			validateMeetingPoint(target);
		}
		
		function validateMeetingPoint(target) {
			var type = $(target).data("type");
			if(type == "vb") {
				
				var errorMessage = validateVb($(target).find("textarea").first().val());
				var errorFieldName = "#" + $(target).attr("id") + "_error";
				if(errorMessage) {
					$(errorFieldName).text(errorMessage);
				} else {
					$(errorFieldName).text("");
				}
			} else if (type == "ekonomisk berättelse") {
				// yadda
				//yaddda validateEberg();
			}
		}

		function saveToJson(event) {
			var target = $(event.currentTarget).parents(".meetingPointContainer").first()
			var type = $(target).data('type');
			
			if(type == "vb") {
				for(var i in json.meetingPoints) {
					var p = json.meetingPoints[i];
					if(p.id == $(target).attr('id')) {
						json.meetingPoints[i].data.text = $(target).find('textarea').first().val();
						
						generateHtml(json);
						localStorage.setItem("json", JSON.stringify(json));
						return true;
					}
				}
			}

			if(type == "meetingOpen") {
				for(var i in json.meetingPoints) {
					var p = json.meetingPoints[i];
					if(p.id == $(target).attr('id')) {
						json.meetingPoints[i].data.meetingOpenTime = $(target).find('input.meetingOpenTime').first().val();
						
						json.meetingPoints[i].data.meetingOpener = $(target).find('input.meetingOpener').first().val();
						
						generateHtml(json);
						localStorage.setItem("json", JSON.stringify(json));
						return true;
					}
				}
			}


		}

		function initMeeting() {
		
			$(".validatorField").each(function(data, target) {
				$(target).on('change keyup', validate);
				
				$(target).on('change keyup', saveToJson);
			});
		}
		
		function htmlPrintVb(p) {
			return '<h2>'+ p.title +'</h2><p>' + p.data.text + '</p>';
		}
		
		function htmlPrintMeetingOpen(p) {
			return '<h2>'+ p.title +'</h2><p>' + p.data.meetingOpener + " öppnade mötet klockan " + p.data.meetingOpenTime + '</p>';
		}

		function formPrintVb(p) {
			var data = '<div class="meetingPointContainer" id="' + p.id + '" data-type="'+ p.type +'" data-datatype="'+ p.type +'"><h2>'+ p.title +'</h2><textarea class="validatorField">'+p.data.text+'</textarea><br><span class="errorMessage" id="'+ p.id +'_error"></span></div>';
			return data;
		}
		
		function formPrintMeetingOpen(p) {
			var data = '<div class="meetingPointContainer" id="' + p.id + '" data-type="'+ p.type +'" data-datatype="'+ p.type +'">'
					+ '<h2>'+ p.title +'</h2><form>'
					+ 'Mötets öppnare: <input value="'+p.data.meetingOpener +'" class="validatorField meetingOpener"><br>'
					+ 'Öppnat klockan: <input type="time" value="'+p.data.meetingOpenTime +'" class="validatorField meetingOpenTime"><br>'
					+ '<br><span class="errorMessage" id="'+ p.id +'_error"></span></form></div>';
			return data;
		}

		function generateForm(json) {
			var o = $("#input");
			o.empty();
			
			for(var i in json.meetingPoints) {
				var p = json.meetingPoints[i];
				var output = "";
				
				if(p.type == "vb") {
					output = formPrintVb(p);
				} else if (p.type == "meetingOpen") {
					output = formPrintMeetingOpen(p);
				}
				
				o.append("<p>" + output + "</p>");
			}
		

		}
		
		function generateHtml(json) {
			var o = $("#output");
			o.empty();
			
			$("<h1>Möte för " + json.orgName + "</h1>").appendTo(o);
			
			for(var i in json.meetingPoints) {
				var p = json.meetingPoints[i];
				var output = "";
				
				if(p.type == "vb") {
					output = htmlPrintVb(p);
				} else if (p.type == "meetingOpen") {
					output = htmlPrintMeetingOpen(p);
				}
				
				o.append("<p>" + output + "</p>");
			}
		}
	
		window.originalJson = {
				orgType: 123,
				orgName: "Ung Pirat Hästpolololololo",
				meetingPoints: [
					{
						id: "meetingOpens",
						type: "meetingOpen",
						title: "Mötets öppnande",
						datatype: "json",
						data: {
							meetingOpener: "mlg",
							meetingOpenTime: "2016-01-03 12:34:56"
						}
					},
					{
						id: "meetingOpena",
						type: "meetingOpen",
						title: "Mötets andra öppnande",
						datatype: "json",
						data: {
							meetingOpener: "mlg",
							meetingOpenTime: "2016-01-03 12:34:56"
						}
					},
					{
						id: "meetingOpen",
						type: "meetingOpen",
						title: "Mötets tredje öppnande",
						datatype: "json",
						data: {
							meetingOpener: "din mamma",
							meetingOpenTime: "2017-01-03 12:34:56"
						}
					},
					{
						id: "vb",         // vilken specifik punkt det är
						type: "vb",     // vilken typ av fråga det är
						title: "Verksamhetsberättelse för föregående år",
						datatype: "text",
						data: {
							text: "Hej, jag är en hästpool"
						}
					}
				]
			};
			
		function createPanes() {
			// create the left pane, ie the form
			generateForm(json);
			
			// display the error messages
			for(var i in json.meetingPoints) {
				var target = $("#" + json.meetingPoints[i].id);
				validateMeetingPoint(target);
			}
			
			// create the right pane, ie the html output
			generateHtml(json);
			
			// add event listeners to forms
			initMeeting();
		}
			
		$(document).ready(function() {
			//load the meeting data, either from default or storage
			window.json = window.originalJson;
			var jsonFromStorage = localStorage.getItem("json");
			if(jsonFromStorage) {
				jsonFromStorage = JSON.parse(jsonFromStorage);
				if(jsonFromStorage) {	
					window.json = jsonFromStorage;
				}
			}
			
			createPanes();
			
			$("#resetButton").on('click', function(e) {
				e.preventDefault();
				window.json = window.originalJson;
				createPanes();
			});
		});
	</script>
</head>
<body>
	<button id="resetButton">Nollställ</button>
	<div id="input"></div>
	<div id="output"></div>


	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
<div style="display:none;">

	<h1>BTCX Payments - test client</h1>
	<p>This test client can be used to test endpoints, and to experiment with how to format requests to recieve the desired response. Please note that this client makes REAL requests, so use with caution.</p>

	<!-- =========================================== -->

	<h3>Exchange rates <code>/api/v1/rates</code></h3>
	<form>
		<p>Api key<span class="required">*</span><br><input id="getRatesApiKey" /></p>
		<p>Secret key <span class="required">*</span><br><input id="getRatesSecretKey" /></p>
		<button id="getRatesButton">Go!</button>
	</form>
	<h4>Request</h4>
	<code class="pre" id="getRatesAuth"></code>
	<br><br>
	<code class="pre" id="getRatesRequest"></code>
	<h4>Response</h4>
	<code class="pre" id="getRatesResponse"></code>
	
	<!-- =========================================== -->

 
	<h3>New payment request <code>/api/v1/invoice</code></h3>
	<form>
		<p>Api key <span class="required">*</span> <br><input  id="invoiceApiKey" /></p>
		<p>Secret key <span class="required">*</span> <br><input  id="invoiceSecretKey" /></p>
		
		<p>Your invoice # (clear text)<br><input  id="invoicereference" /></p>
		<p>Currency you will recieve (sek)<br><input  id="invoicecurrency" /></p>
		<p>Currency the custumer will pay (btc)<br><input  id="invoicecryptocurrency" /></p>
		<p>Price (in currency you will recieve, eg, sek) <span class="required">*</span> <br><input  id="invoiceprice" /></p>
		
		<p>Webhook url (https://you.com/callback/bitcoin.php)<br><input  id="invoicecallbackurl" /></p>
		<p>Enabled notifications for webhook*<br><input  id="invoicecallbackurlmask" /></p>

		<p>Email for email notifications (payments@you.com)<br><input  id="invoiceemail" /></p>
		<p>Enabled notifications for email*<br><input  id="invoiceemailmask" /></p>
		
		<p>Phone number for SMS notifications (0737123456)<br><input  id="invoicesms" /></p>
		<p>Enabled notifications for SMS*<br><input  id="invoicesmsmask" /></p>
		
		<p>* This is a bitfield with the state changes you wish to recieve callbacks for. If this is omitted you will recieve callabacks for all state changes.<br>1: partiallypaid, 2: paid, 4: confirmed, 8. complete, 16: expired, 32: error.<br>Eg, if you wish to recieve callbacks only for states paid and error, set this field to 2 + 32 = 34</p>
		
		<button id="invoiceButton">Go!</button>
	</form>
	<h4>Request</h4>
	<code class="pre" id="invoiceAuth"></code>
	<br><br>
	<code class="pre" id="invoiceRequest"></code>
	<h4>Response</h4>
	<code class="pre" id="invoiceResponse"></code>


	<!-- =========================================== -->

 
	<h3>Check state of transactions <code>/api/v1/transactions</code></h3>
	<form>
		<p>Api key <span class="required">*</span> <br><input  id="transactionsApiKey" /></p>
		<p>Secret key <span class="required">*</span> <br><input  id="transactionsSecretKey" /></p>
		
		<p>Txid (return only this specific transaction)<br><input  id="transactionsTxid" /></p>
		<p>Your invoice # (clear text)*<br><input  id="transactionsReference" /></p>
		<p>Return transactions after date (2016-01-02 12:34:56)<br><input  id="transactionsstartDate" /></p>
		<p>Return transactions before date (2016-01-02 12:34:56)<br><input  id="transactionsendDate" /></p>
		<p>Return only transactions of state (Eg, paid, completed)<br><input  id="transactionsState" /></p>
		
		<p>* Wildcards are supported: % (matches 0 or more characters) and _ (matches exactly one character).</p>
		
		<button id="transactionsButton">Go!</button>
	</form>
	<h4>Request</h4>
	<code class="pre" id="transactionsAuth"></code>
	<br><br>
	<code class="pre" id="transactionsRequest"></code>
	<h4>Response</h4>
	<code class="pre" id="transactionsResponse"></code>
</div>	
</body>
</html>
